from __future__ import annotations
import sys
from importlib.machinery import ModuleSpec, PathFinder
from importlib.machinery import all_suffixes as module_suffixes
from importlib.util import spec_from_file_location
from itertools import chain
from pathlib import Path

MAPPING: dict[str, str] = {'data': 'C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\data', 'output': 'C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\output', 'processor': 'C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\processor', 'tests': 'C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\tests', 'venv': 'C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv'}
NAMESPACES: dict[str, list[str]] = {'data': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\data'], 'output': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\output'], 'processor': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\processor'], 'tests': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\tests'], 'venv': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv'], 'venv.Include': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Include'], 'venv.Lib': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib'], 'venv.Scripts': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Scripts'], 'venv.Include.site': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Include\\site'], 'venv.Lib.site-packages': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages'], 'venv.Lib.site-packages.google': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google'], 'venv.Lib.site-packages.tiktoken_ext': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\tiktoken_ext'], 'venv.Lib.site-packages.google.ai': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\ai'], 'venv.Lib.site-packages.google.api': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\api'], 'venv.Lib.site-packages.google.cloud': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\cloud'], 'venv.Lib.site-packages.google.gapic': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\gapic'], 'venv.Lib.site-packages.google.logging': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\logging'], 'venv.Lib.site-packages.google.longrunning': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\longrunning'], 'venv.Lib.site-packages.google.rpc': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\rpc'], 'venv.Lib.site-packages.google.type': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\type'], 'venv.Lib.site-packages.google._upb': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\_upb'], 'venv.Lib.site-packages.google.cloud.location': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\cloud\\location'], 'venv.Lib.site-packages.google.gapic.metadata': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\gapic\\metadata'], 'venv.Lib.site-packages.google.logging.type': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\logging\\type'], 'venv.Lib.site-packages.google.rpc.context': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\google\\rpc\\context'], 'venv.Lib.site-packages.grpc._cython._credentials': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\grpc\\_cython\\_credentials'], 'venv.Lib.site-packages.langchain.agents.agent_toolkits.amadeus': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langchain\\agents\\agent_toolkits\\amadeus'], 'venv.Lib.site-packages.langchain.chains.llm_summarization_checker.prompts': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langchain\\chains\\llm_summarization_checker\\prompts'], 'venv.Lib.site-packages.langchain.document_transformers.xsl': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langchain\\document_transformers\\xsl'], 'venv.Lib.site-packages.langchain.llms.grammars': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langchain\\llms\\grammars'], 'venv.Lib.site-packages.langchain_community.document_transformers.xsl': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langchain_community\\document_transformers\\xsl'], 'venv.Lib.site-packages.langchain_community.llms.grammars': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langchain_community\\llms\\grammars'], 'venv.Lib.site-packages.langchain_community.tools.reddit_search': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langchain_community\\tools\\reddit_search'], 'venv.Lib.site-packages.langchain_text_splitters.xsl': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langchain_text_splitters\\xsl'], 'venv.Lib.site-packages.langsmith.cli': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langsmith\\cli'], 'venv.Lib.site-packages.langsmith._internal.otel': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\langsmith\\_internal\\otel'], 'venv.Lib.site-packages.numpy.doc': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\doc'], 'venv.Lib.site-packages.numpy.distutils.checks': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\distutils\\checks'], 'venv.Lib.site-packages.numpy.distutils.mingw': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\distutils\\mingw'], 'venv.Lib.site-packages.numpy.f2py.src': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\src'], 'venv.Lib.site-packages.numpy.f2py.tests.src': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src'], 'venv.Lib.site-packages.numpy.f2py.tests.src.abstract_interface': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\abstract_interface'], 'venv.Lib.site-packages.numpy.f2py.tests.src.array_from_pyobj': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\array_from_pyobj'], 'venv.Lib.site-packages.numpy.f2py.tests.src.assumed_shape': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\assumed_shape'], 'venv.Lib.site-packages.numpy.f2py.tests.src.block_docstring': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\block_docstring'], 'venv.Lib.site-packages.numpy.f2py.tests.src.callback': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\callback'], 'venv.Lib.site-packages.numpy.f2py.tests.src.cli': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\cli'], 'venv.Lib.site-packages.numpy.f2py.tests.src.common': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\common'], 'venv.Lib.site-packages.numpy.f2py.tests.src.crackfortran': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\crackfortran'], 'venv.Lib.site-packages.numpy.f2py.tests.src.f2cmap': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\f2cmap'], 'venv.Lib.site-packages.numpy.f2py.tests.src.isocintrin': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\isocintrin'], 'venv.Lib.site-packages.numpy.f2py.tests.src.kind': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\kind'], 'venv.Lib.site-packages.numpy.f2py.tests.src.mixed': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\mixed'], 'venv.Lib.site-packages.numpy.f2py.tests.src.modules': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\modules'], 'venv.Lib.site-packages.numpy.f2py.tests.src.negative_bounds': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\negative_bounds'], 'venv.Lib.site-packages.numpy.f2py.tests.src.parameter': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\parameter'], 'venv.Lib.site-packages.numpy.f2py.tests.src.quoted_character': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\quoted_character'], 'venv.Lib.site-packages.numpy.f2py.tests.src.regression': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\regression'], 'venv.Lib.site-packages.numpy.f2py.tests.src.return_character': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\return_character'], 'venv.Lib.site-packages.numpy.f2py.tests.src.return_complex': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\return_complex'], 'venv.Lib.site-packages.numpy.f2py.tests.src.return_integer': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\return_integer'], 'venv.Lib.site-packages.numpy.f2py.tests.src.return_logical': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\return_logical'], 'venv.Lib.site-packages.numpy.f2py.tests.src.return_real': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\return_real'], 'venv.Lib.site-packages.numpy.f2py.tests.src.routines': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\routines'], 'venv.Lib.site-packages.numpy.f2py.tests.src.size': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\size'], 'venv.Lib.site-packages.numpy.f2py.tests.src.string': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\string'], 'venv.Lib.site-packages.numpy.f2py.tests.src.value_attrspec': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\value_attrspec'], 'venv.Lib.site-packages.numpy.f2py.tests.src.modules.gh25337': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\modules\\gh25337'], 'venv.Lib.site-packages.numpy.f2py.tests.src.modules.gh26920': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\f2py\\tests\\src\\modules\\gh26920'], 'venv.Lib.site-packages.numpy.lib.tests.data': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\lib\\tests\\data'], 'venv.Lib.site-packages.numpy.random.lib': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\random\\lib'], 'venv.Lib.site-packages.numpy.random._examples': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\random\\_examples'], 'venv.Lib.site-packages.numpy.random._examples.cffi': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\random\\_examples\\cffi'], 'venv.Lib.site-packages.numpy.random._examples.cython': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\random\\_examples\\cython'], 'venv.Lib.site-packages.numpy.random._examples.numba': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\random\\_examples\\numba'], 'venv.Lib.site-packages.numpy.typing.tests.data': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\typing\\tests\\data'], 'venv.Lib.site-packages.numpy.typing.tests.data.fail': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\typing\\tests\\data\\fail'], 'venv.Lib.site-packages.numpy.typing.tests.data.misc': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\typing\\tests\\data\\misc'], 'venv.Lib.site-packages.numpy.typing.tests.data.pass': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\typing\\tests\\data\\pass'], 'venv.Lib.site-packages.numpy.typing.tests.data.reveal': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\typing\\tests\\data\\reveal'], 'venv.Lib.site-packages.numpy._core.include': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\include'], 'venv.Lib.site-packages.numpy._core.lib': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\lib'], 'venv.Lib.site-packages.numpy._core.tests': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\tests'], 'venv.Lib.site-packages.numpy._core.include.numpy': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\include\\numpy'], 'venv.Lib.site-packages.numpy._core.include.numpy.random': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\include\\numpy\\random'], 'venv.Lib.site-packages.numpy._core.lib.npy-pkg-config': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\lib\\npy-pkg-config'], 'venv.Lib.site-packages.numpy._core.lib.pkgconfig': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\lib\\pkgconfig'], 'venv.Lib.site-packages.numpy._core.tests.data': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\tests\\data'], 'venv.Lib.site-packages.numpy._core.tests.examples': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\tests\\examples'], 'venv.Lib.site-packages.numpy._core.tests.examples.cython': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\tests\\examples\\cython'], 'venv.Lib.site-packages.numpy._core.tests.examples.limited_api': ['C:\\Users\\Suhas.v\\Desktop\\unified-log-processor\\venv\\Lib\\site-packages\\numpy\\_core\\tests\\examples\\limited_api']}
PATH_PLACEHOLDER = '__editable__.unified_log_processor-0.1.0.finder' + ".__path_hook__"


class _EditableFinder:  # MetaPathFinder
    @classmethod
    def find_spec(cls, fullname: str, path=None, target=None) -> ModuleSpec | None:  # type: ignore
        # Top-level packages and modules (we know these exist in the FS)
        if fullname in MAPPING:
            pkg_path = MAPPING[fullname]
            return cls._find_spec(fullname, Path(pkg_path))

        # Handle immediate children modules (required for namespaces to work)
        # To avoid problems with case sensitivity in the file system we delegate
        # to the importlib.machinery implementation.
        parent, _, child = fullname.rpartition(".")
        if parent and parent in MAPPING:
            return PathFinder.find_spec(fullname, path=[MAPPING[parent]])

        # Other levels of nesting should be handled automatically by importlib
        # using the parent path.
        return None

    @classmethod
    def _find_spec(cls, fullname: str, candidate_path: Path) -> ModuleSpec | None:
        init = candidate_path / "__init__.py"
        candidates = (candidate_path.with_suffix(x) for x in module_suffixes())
        for candidate in chain([init], candidates):
            if candidate.exists():
                return spec_from_file_location(fullname, candidate)
        return None


class _EditableNamespaceFinder:  # PathEntryFinder
    @classmethod
    def _path_hook(cls, path) -> type[_EditableNamespaceFinder]:
        if path == PATH_PLACEHOLDER:
            return cls
        raise ImportError

    @classmethod
    def _paths(cls, fullname: str) -> list[str]:
        paths = NAMESPACES[fullname]
        if not paths and fullname in MAPPING:
            paths = [MAPPING[fullname]]
        # Always add placeholder, for 2 reasons:
        # 1. __path__ cannot be empty for the spec to be considered namespace.
        # 2. In the case of nested namespaces, we need to force
        #    import machinery to query _EditableNamespaceFinder again.
        return [*paths, PATH_PLACEHOLDER]

    @classmethod
    def find_spec(cls, fullname: str, target=None) -> ModuleSpec | None:  # type: ignore
        if fullname in NAMESPACES:
            spec = ModuleSpec(fullname, None, is_package=True)
            spec.submodule_search_locations = cls._paths(fullname)
            return spec
        return None

    @classmethod
    def find_module(cls, _fullname) -> None:
        return None


def install():
    if not any(finder == _EditableFinder for finder in sys.meta_path):
        sys.meta_path.append(_EditableFinder)

    if not NAMESPACES:
        return

    if not any(hook == _EditableNamespaceFinder._path_hook for hook in sys.path_hooks):
        # PathEntryFinder is needed to create NamespaceSpec without private APIS
        sys.path_hooks.append(_EditableNamespaceFinder._path_hook)
    if PATH_PLACEHOLDER not in sys.path:
        sys.path.append(PATH_PLACEHOLDER)  # Used just to trigger the path hook
